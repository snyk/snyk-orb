description: Download the Snyk CLI. Runs as part of the scan command.
parameters:
  os:
    description: The CLI OS version to download
    type: enum
    enum: ["linux", "macos"]
    default: "linux"
  token-variable:
    description: >
      Name of env var containing your Snyk API token. Pass this as a raw string such
      as CIRCLECI_SNYK_TOKEN. Do not paste the actual token into your
      configuration. If omitted it's assumed the CLI has already been setup
      with a valid token.
    type: env_var_name
    default: SNYK_TOKEN
steps:
  - run: 
      name: Download Snyk CLI
      command: |
        if [[ ! -x "/usr/local/bin/snyk" ]]; then
          curl -s https://api.github.com/repos/snyk/snyk/releases/latest | grep "browser_download_url" | grep <<parameters.os>> | cut -d '"' -f 4 | wget -qi -
          sha256sum -c snyk-<<parameters.os>>.sha256
          sudo mv snyk-<<parameters.os>> /usr/local/bin/snyk
          sudo chmod +x /usr/local/bin/snyk
        fi
        snyk config set disableSuggestions=true
        <<#parameters.token-variable>>snyk auth $<<parameters.token-variable>><</parameters.token-variable>>
