description: Test the application dependencies for known vulnerabilities
parameters:
  severity:
    description: Only report vulnerabilities of provided level or higher (low/medium/high). Default is low.
    type: enum
    enum: ["low", "medium", "high"]
    default: "low"
  failOnIssues:
    description: This specifies if builds should be failed or continued based on issues found by Snyk.
    type: boolean
    default: true
  targetFile:
    description: The path to the manifest file to be used by Snyk.
    type: string
    default: ""
  dockerImageName:
    description: The image name, if scanning a container image
    type: string
    default: ""
  additionalArguments:
    description: Refer to the Snyk CLI help page for information on additional arguments.
    type: string
    default: ""
steps:
  - run:
      name: "Run Snyk Test to scan app for vulnerabilities"
      command: |
        snyk test ${SNYK_SEVERITY:+--severity-threshold=$SNYK_SEVERITY} ${SNYK_ORGANIZATION:+--org=$SNYK_ORGANIZATION} ${SNYK_TARGET_FILE:+--file=$SNYK_TARGET_FILE} ${SNYK_DOCKER_IMAGE:+--docker $SNYK_DOCKER_IMAGE} <<parameters.additionalArguments>> || [[ "<<parameters.failOnIssues>>" != "true" ]]
      environment:
        SNYK_SEVERITY: <<parameters.severity>>
        SNYK_TARGET_FILE: <<parameters.targetFile>>
        SNYK_DOCKER_IMAGE: <<parameters.dockerImageName>>
