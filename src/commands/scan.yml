description: Scan the application dependencies for known vulnerabilities with Snyk. This command calls the others, and should be used as the command for scanning.
parameters:
  severity:
    description: Only report vulnerabilities of provided level or higher (low/medium/high). Default is low.
    type: enum
    enum: ["low", "medium", "high"]
    default: "low"
  protect:
    description: Protect the app by applying patches specified in your .snyk file (after running the Snyk wizard)
    type: boolean
    default: false  
  failOnIssues:
    description: This specifies if builds should be failed or continued based on issues found by Snyk.
    type: boolean
    default: true
  monitorOnBuild:
    description: Take a current application dependencies snapshot for continuous monitoring by Snyk, if test was succesful.
    type: boolean
    default: true
  targetFile:
    description: The path to the manifest file to be used by Snyk.
    type: string
    default: ""
  dockerImageName:
    description: The image name, if scanning a container image
    type: string
    default: ""
  additionalArguments:
    description: Refer to the Snyk CLI help page for information on additional arguments.
    type: string
    default: ""
  os:
    description: The CLI OS version to download
    type: enum
    enum: ["linux", "macos"]
    default: "linux"
steps:
  - install:
      os: <<parameters.os>>
  - when:
      condition: <<parameters.protect>>
      steps:
        - protect:
            additionalArguments: <<parameters.additionalArguments>>
  - test:
      severity: <<parameters.severity>>
      failOnIssues: <<parameters.failOnIssues>>
      targetFile: <<parameters.targetFile>>
      dockerImageName: <<parameters.dockerImageName>>
      additionalArguments: <<parameters.additionalArguments>>
  - when:
      condition: <<parameters.monitorOnBuild>>
      steps:
        - monitor:
            targetFile: <<parameters.targetFile>>
            dockerImageName: <<parameters.dockerImageName>>
            additionalArguments: <<parameters.additionalArguments>>
