description: |
  Use the Snyk orb inside a build job to scan a container image for known vulnerabilities
usage:
  version: 2.1

  orbs:
    snyk: snyk/snyk@x.y.z

  jobs:
    build:
      environment:
        IMAGE_NAME: myrepo/myapp
      docker:
          - image: circleci/buildpack-deps:stretch
      steps:
        - checkout
        - setup_remote_docker
        - run:
            name: Build Docker image
            command: docker build -t $IMAGE_NAME:latest .
        - snyk/scan:
            token-variable: SNYK_TOKEN
            dockerImageName: $IMAGE_NAME:latest
            targetFile: "Dockerfile"
            severity: high
            failOnIssues: true
            monitorOnBuild: true
            project: ${CIRCLE_PROJECT_REPONAME}/${CIRCLE_BRANCH}-container
